<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeteEduca - Painel de Cadastramento</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #fafafa; min-height: 100vh; color: #2d3748; }
        
        .sidebar { width: 280px; height: 100vh; background: linear-gradient(180deg, #FFF4DF 0%, #f8f0e3 100%); color: white; padding: 20px 0; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1); z-index: 100; transition: transform 0.3s ease; }
        .sidebar.mobile-hidden { transform: translateX(-100%); }
        
        .logo { padding: 0px 40px; text-align: center; margin-bottom: 25px; margin-top: 30px; }
        .logo img { max-width: 100%; height: auto; }
        
        .menu { flex: 1; padding: 10px 18px; margin-top: 35px; }
        .menu-item { padding: 30px 20px; margin-bottom: 6px; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; position: relative; display: flex; align-items: center; font-weight: 500; overflow: visible; color: black; }
        .menu-item i { margin-right: 15px; font-size: 18px; width: 24px; text-align: center; z-index: 2; }
        .menu-item span { z-index: 2; font-size: 15px; }
        .menu-item:hover { background-color: #6c757d21; }
        
        .menu-item::after { padding: 0 10px; content: ''; position: absolute; bottom: -3px; left: 20px; height: 2px; width: 0px; transition: width 0.3s ease; border-radius: 1px; }
        .menu-item:hover::after, .menu-item.active::after { width: calc(100% - 40px); }
        
        .menu-item:nth-child(1)::after { background-color: #F4BF27; }
        .menu-item:nth-child(2)::after { background-color: #306bc2; }
        .menu-item:nth-child(3)::after { background-color: #9747FF; }
        .menu-item:nth-child(4)::after { background-color: #F88C12; }
        .menu-item:nth-child(5)::after { background-color: #D22A2A; }
        .menu-item:nth-child(6)::after { background-color: #59C631; }
        
        .menu-item.active { background-color: rgba(128, 128, 128, 0.356); color: #333; font-weight: 600; }
       .menu-item.active::before {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: currentColor;
            z-index: 2;
        }
        .seteeduca { color: #333; margin-top: 90px; position: absolute; margin-left: 70px; }
        .sidebar-footer { padding: 20px 18px; border-top: 1px solid rgba(0, 0, 0, 0.1); }
        
        .logout-button { padding: 16px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; font-weight: 500; color: #333; width: 100%; }
        .logout-button i { margin-right: 15px; font-size: 18px; width: 24px; text-align: center; }
        .logout-button:hover { background-color: rgba(210, 42, 42, 0.1); color: #D22A2A; font-weight: 600; }
        
        .mobile-menu-toggle { display: none; position: fixed; top: 15px; left: 15px; z-index: 101; background: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        .mobile-menu-toggle i { font-size: 20px; color: #306bc2; }
        
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 99; }
        .sidebar-overlay.active { display: block; }
        
        .main-content { margin-left: 280px; min-height: 100vh; display: flex; flex-direction: column; transition: margin-left 0.3s ease; }
        
        .header { background: #306bc2; height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; color: white; width: 100%; }
        .header-title { display: flex; align-items: center; position: relative; top: 0.7vh; gap: 10px; font-size: 1.5rem; color: rgb(255, 255, 255); font-family: 'Kodchasan', sans-serif; }
        .header-title i { font-size: 20px; }
        
        .profile { position: relative; cursor: pointer; margin-left: auto; }
        .profile-header { display: flex; align-items: center; gap: 12px; color: white; padding: 5px; border-radius: 8px; transition: background 0.2s; }
        .profile-header:hover { background: rgba(255, 255, 255, 0.1); }
        .profile-icon { font-size: 28px; }
        .profile-arrow { font-size: 14px; transition: transform 0.3s ease; color: white; }
        
        .profile-dropdown { display: none; position: absolute; top: 130%; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); width: 200px; padding: 8px 0; z-index: 1000; flex-direction: column; border: 1px solid #edf2f7; }
        .profile-dropdown.active { display: flex; animation: fadeIn 0.2s ease; }
        .profile-dropdown a { padding: 12px 20px; text-decoration: none; color: #4a5568; display: flex; align-items: center; gap: 12px; font-size: 14px; transition: all 0.2s; border-left: 3px solid transparent; }
        .profile-dropdown a:hover { background: #f7fafc; color: #306bc2; border-left-color: #306bc2; }
        .profile-dropdown a i { width: 16px; text-align: center; font-size: 16px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .content-area { padding: 40px; background: #fafafa; flex: 1; display: flex; justify-content: center; align-items: flex-start; }
        .registration-panel { width: 100%; max-width: 900px; background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .panel-header { background: white; border-radius: 12px; border-top: 5px solid #306bc2; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .panel-content { padding: 40px; }
        
        .form-section { margin-bottom: 32px; }
        .section-title { font-size: 16px; font-weight: 600; color: #2d3748; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        .section-title i { color: #306bc2; font-size: 14px; }
        
        .form-grid { display: grid; gap: 20px; }
        .form-grid.two-columns { grid-template-columns: 1fr 1fr; }
        .form-field { display: flex; flex-direction: column; gap: 6px; }
        .form-field.full-width { grid-column: 1 / -1; }
        
        .form-label { font-size: 13px; font-weight: 500; color: #4a5568; letter-spacing: -0.01em; }
        .form-input, .form-select, .form-textarea { padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-family: inherit; transition: all 0.2s ease; background: #fafafa; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #306bc2; background: white; box-shadow: 0 0 0 3px rgba(3, 75, 207, 0.1); }
        .form-textarea { resize: vertical; min-height: 80px; }
        .form-input::placeholder, .form-textarea::placeholder { color: #a0aec0; }
        
        .radio-group { display: flex; gap: 20px; margin-top: 4px; }
        .radio-item { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .radio-item input[type="radio"] { width: 16px; height: 16px; accent-color: #306bc2; }
        .radio-item label { font-size: 14px; color: #4a5568; cursor: pointer; }
        
        .photo-upload-section { text-align: center; padding: 24px; border: 2px dashed #e2e8f0; border-radius: 12px; margin-bottom: 32px; transition: all 0.3s ease; }
        .photo-upload-section:hover { border-color: #306bc2; background: rgba(3, 75, 207, 0.02); }
        
        .photo-preview { width: 80px; height: 80px; border-radius: 50%; background: #f7fafc; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; color: #cbd5e0; }
        .photo-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        
        .upload-btn { padding: 8px 20px; background: #306bc2; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .upload-btn:hover { background: #2557a0; transform: translateY(-1px); }
        
        .action-buttons { display: flex; justify-content: center; gap: 16px; padding-top: 32px; margin-top: 32px; border-top: 1px solid #f7fafc; }
        
        .btn { padding: 12px 32px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-family: inherit; }
        .btn-primary { background: #306bc2; color: white; }
        .btn-primary:hover { background: #2557a0; transform: translateY(-1px); }
        .btn-secondary { background: #f7fafc; color: #4a5568; border: 1px solid #e2e8f0; }
        .btn-secondary:hover { background: #edf2f7; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 32px; border-radius: 16px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); animation: modalSlideIn 0.3s ease; }
        .modal-content.error::before { content: "✕"; background: #D22A2A; margin-top: -16px; }
        .modal-content::before { content: "✓"; display: block; width: 60px; height: 60px; background: #48bb78; color: white; border-radius: 50%; font-size: 24px; font-weight: bold; line-height: 60px; margin: -16px auto 20px; }
        .modal-content h3 { font-size: 18px; font-weight: 600; color: #2d3748; margin-bottom: 8px; }
        .modal-content p { font-size: 14px; color: #718096; margin-bottom: 24px; line-height: 1.5; }
        .modal-btn { padding: 10px 24px; background: #306bc2; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .modal-btn:hover { background: #2557a0; }
        .modal-btn.error-btn { background: #D22A2A; }
        .modal-btn.error-btn:hover { background: #a02121; }
        
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        @media (max-width: 1024px) {
            .sidebar { width: 240px; }
            .main-content { margin-left: 240px; }
            .menu-item { padding: 20px 15px; }
            .content-area { padding: 30px; }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle { display: block; }
            .sidebar { width: 280px; }
            .sidebar.mobile-hidden { transform: translateX(-100%); }
            .main-content { margin-left: 0; }
            .header { padding: 0 20px 0 70px; }
            .header-title { font-size: 16px; }
            .header-title span { display: none; }
            .content-area { padding: 20px; }
            .panel-content { padding: 24px; }
            .form-grid.two-columns { grid-template-columns: 1fr; }
            .form-field.full-width { grid-column: 1; }
            .action-buttons { flex-direction: column; }
            .btn { width: 100%; }
            .seteeduca { display: none; }
            .profile-arrow { display: none; }
        }
        
        @media (max-width: 480px) {
            .header { height: 60px; padding: 0 15px 0 60px; }
            .header-title i { font-size: 18px; }
            .content-area { padding: 15px; }
            .panel-content { padding: 20px; }
            .form-section { margin-bottom: 24px; }
            .section-title { font-size: 15px; }
            .form-input, .form-select, .form-textarea { padding: 10px 14px; font-size: 13px; }
            .radio-group { flex-direction: column; gap: 12px; }
            .photo-preview { width: 70px; height: 70px; }
            .upload-btn { padding: 8px 16px; font-size: 11px; }
            .btn { padding: 10px 24px; font-size: 13px; }
            .modal-content { padding: 24px; margin: 20px; }
        }
        
        @media (min-width: 769px) {
            .sidebar { transform: translateX(0) !important; }
        }
        /* --- COLE ISSO NO FINAL DO SEU STYLE --- */

@media (max-width: 768px) {
    
    /* 1. MATAR O QUADRADINHO E O FUNDO ESCURO */
    .mobile-menu-toggle, 
    .sidebar-overlay {
        display: none !important;    /* Remove da tela */
        opacity: 0 !important;       /* Torna invisível */
        pointer-events: none !important; /* Impede cliques fantasmas */
        width: 0 !important;
        height: 0 !important;
    }

    /* 2. FORÇAR A BARRA A APARECER (MINI) */
    .sidebar, 
    .sidebar.mobile-hidden {
        transform: none !important;      /* Cancela o movimento de esconder */
        left: 0 !important;              /* Cola na esquerda */
        width: 70px !important;          /* Largura fina */
        display: flex !important;        /* Garante que o container exista */
        z-index: 9999 !important;        /* Fica por cima de tudo */
    }

    /* 3. EMPURRAR O CONTEÚDO PARA A DIREITA */
    .main-content {
        margin-left: 70px !important;        /* Espaço para a barra fina */
        width: calc(100% - 70px) !important; /* Ocupa o resto da tela */
    }

    /* 4. ESCONDER TEXTOS (Deixar só ícones) */
    .menu-item span, 
    .logout-button span, 
    .seteeduca, 
    .header-title i, /* Se o ícone do header parecer um menu, isso remove */
    .profile-arrow {
        display: none !important;
    }

    /* 5. CENTRALIZAR ÍCONES PERFEITAMENTE */
    .menu-item, 
    .logout-button {
        justify-content: center !important;
        padding: 20px 0 !important;
    }

    .menu-item i, 
    .logout-button i {
        margin-right: 0 !important;
        font-size: 22px !important;
        display: block !important;
    }

    /* 6. AJUSTAR LOGO PEQUENA */
    .logo {
        padding: 0 !important;
        margin-top: 20px !important; 
        text-align: center !important;
    }
    .logo img {
        max-width: 40px !important;
    }

    /* 7. REMOVER LINHAS DECORATIVAS EXTRAS */
    .menu-item::after { display: none !important; }
    
    /* Ajuste da bolinha de item ativo */
    .menu-item.active::before {
        right: 5px !important;
    }

    /* 8. AJUSTES DO FORMULÁRIO (Para não quebrar) */
    .content-area { padding: 15px !important; }
    .form-grid.two-columns { grid-template-columns: 1fr !important; }
    .form-field.full-width { grid-column: 1 !important; }
    .btn { width: 100% !important; }
}
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="sidebar-overlay" onclick="toggleMobileMenu()"></div>

    <div class="sidebar mobile-hidden" id="sidebar">
        <div class="logo">
           <img src="/logo.png" alt="logo">
        </div>
        
        <div class="menu">
             <div class="menu-item" onclick="navegarPara('inicio')">
                <i class="fas fa-home"></i>
                <span>INÍCIO</span>
            </div>
            <div class="menu-item active" onclick="navegarPara('cadastro')">
                <i class="fas fa-address-card"></i>
                <span>CADASTRO</span>
            </div>
            <div class="menu-item" onclick="navegarPara('matricula')">
                <i class="fas fa-user-graduate"></i>
                <span>MATRÍCULA</span>
            </div>
            <div class="menu-item" onclick="navegarPara('professor')">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>PROFESSOR</span>
            </div>
            <div class="menu-item" onclick="navegarPara('turmas')"> 
                <i class="fas fa-users"></i>
                <span>TURMA</span>
            </div>
           <div class="menu-item" onclick="navegarPara('financeiro')">
                <i class="fas fa-dollar-sign"></i>
                <span>FINANCEIRO</span>
            </div>
        </div>

        <div class="seteeduca">
            <p></p>
        </div>
        
        <div class="sidebar-footer">
            <div class="logout-button">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Sair</span>
            </div>
        </div>
    </div> 

    <div class="main-content">
        <div class="header">
            <div class="header-title">
                <i class="fas fa-address-card"></i>
                <span>Painel <b>CADASTRAMENTO</b></span>
            </div>
            <div class="profile" id="profile-toggle">
                <div class="profile-header">
                    <i class="fas fa-user-circle profile-icon"></i>
                    <i class="fas fa-chevron-down profile-arrow"></i>
                </div>
                <div class="profile-dropdown" id="profile-dropdown-menu">
                    <a href="/meuperfil"><i class="fas fa-user"></i> Meu perfil</a>
                    <a href="/mensalidade"><i class="fas fa-file-invoice-dollar"></i> Mensalidade</a>
                    <a href="/arquivados"><i class="fas fa-archive"></i> Arquivados</a>
                </div>
            </div>
        </div>

        <div class="content-area">
           <div class="registration-panel">
                <div class="panel-header"></div>

                <div class="panel-content">
                    
                    <form id="registrationForm" method="POST" action="/acessar-aluno/cadastrar">
                        
                        <input type="hidden" name="foto_crianca" id="campoFotoBase64">

                        <div class="photo-upload-section">
                            <div class="photo-preview" id="photoPreview">
                                <i class="fas fa-camera"></i>
                            </div>
                            <button type="button" class="upload-btn" onclick="uploadPhoto()">
                                Adicionar Foto
                            </button>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user"></i>
                                Informações Pessoais
                            </h3>
                            <div class="form-grid two-columns">
                                <div class="form-field full-width">
                                    <label class="form-label">Nome Completo</label>
                                    <input type="text" class="form-input" name="nome" placeholder="Nome completo da criança" required>
                                </div>
                                <div class="form-field">
                                  <label class="form-label">Data de Nascimento</label>
                                  <input type="date" class="form-input" name="dataNascimento" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">CPF</label>
                                    <input type="text" class="form-input" name="cpf" placeholder="000.000.000-00">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Sexo</label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="feminino" name="sexo" value="feminino" required>
                                            <label for="feminino">Feminino</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="masculino" name="sexo" value="masculino" required>
                                            <label for="masculino">Masculino</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Naturalidade</label>
                                    <input type="text" class="form-input" name="naturalidade" placeholder="Cidade de nascimento" required>
                                </div>
                            </div>
                        </div>

                          <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-phone"></i>
                                Responsável
                            </h3>
                            <div class="form-grid two-columns">
                                <div class="form-field"> 
                                    <label class="form-label">Nome do Responsável</label>
                                    <input type="text" class="form-input" name="responsavel" placeholder="Nome completo" required>
                                </div>

                                <div class="form-field">
                                    <label class="form-label">CPF do Responsável</label>
                                    <input type="text" class="form-input" name="cpf_responsavel" placeholder="000.000.000-00" required>
                                </div>

                                <div class="form-field">
                                    <label class="form-label">Telefone</label>
                                    <input type="tel" class="form-input" name="telefone" placeholder="(11) 99999-9999" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">E-mail</label>
                                    <input type="email" class="form-input" name="email" placeholder="exemplo@email.com" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-map-marker-alt"></i>
                                Endereço
                            </h3>
                            <div class="form-grid two-columns">
                                <div class="form-field">
                                    <label class="form-label">CEP</label>
                                    <input type="text" class="form-input" name="cep" placeholder="00000-000" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Cidade</label>
                                    <input type="text" class="form-input" name="cidade" placeholder="Cidade" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Estado</label>
                                    <input type="text" class="form-input" name="estado" placeholder="Estado" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Logradouro</label>
                                    <input type="text" class="form-input" name="logradouro" placeholder="Rua, Avenida, etc." required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Número</label>
                                    <input type="text" class="form-input" name="numero" placeholder="123" required>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Bairro</label>
                                    <input type="text" class="form-input" name="bairro" placeholder="Bairro" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                           <h3 class="section-title">
                               <i class="fas fa-address-card"></i>
                                Informações de Saúde
                           </h3>
                            <div class="form-grid two-columns">
                                <div class="form-field full-width">
                                    <label class="form-label">Observações</label>
                                    <textarea class="form-textarea" name="observacoes" placeholder="Informações adicionais, alergias, medicações..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                Limpar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Cadastrar Criança
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="successModal">
        <div class="modal-content">
            <h3>Cadastro Realizado!</h3>
            <p id="successMessage">A criança foi cadastrada com sucesso no sistema.</p>
            <button class="modal-btn" onclick="closeModal('successModal')">Entendi</button>
        </div>
    </div>

    <div class="modal" id="errorModal">
        <div class="modal-content error">
            <h3>Ocorreu um Erro!</h3>
            <p id="errorMessage">Não foi possível completar o cadastro.</p>
            <button class="modal-btn error-btn" onclick="closeModal('errorModal')">Tentar Novamente</button>
        </div>
    </div>

    <script>
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('mobile-hidden');
            overlay.classList.toggle('active');
        }

        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
                document.querySelectorAll('.menu-item').forEach(i => {
                    i.classList.remove('active');
                });
                this.classList.add('active');
            });
        });

        function navegarPara(pagina) {
            const rotas = {
                'inicio': '/home',
                'professor': '/professores',
                'financeiro': '/financeiro',
                'turmas': '/turmas',
                'matricula': '/matriculas',
                'cadastro': '/acessar-aluno' 
            };
            if (rotas[pagina]) {
                window.location.href = rotas[pagina];
            }
        }

        function uploadPhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('photoPreview');
                        preview.innerHTML = '<img src="' + e.target.result + '" alt="Foto da criança">';
                        if(document.getElementById('campoFotoBase64')) {
                            document.getElementById('campoFotoBase64').value = e.target.result;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function resetForm() {
            document.getElementById('registrationForm').reset();
            document.getElementById('photoPreview').innerHTML = '<i class="fas fa-camera"></i>';
            if(document.getElementById('campoFotoBase64')) {
                document.getElementById('campoFotoBase64').value = '';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'successModal') {
                window.location.href = '/acessar-aluno';
            }
        }

        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault(); 
            const form = e.target;
            const formData = new FormData(form);
            
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            const url = form.action;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('successMessage').textContent = data.nome + ' foi cadastrada com sucesso!';
                    document.getElementById('successModal').style.display = 'flex';
                    resetForm();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.details || errorData.error || 'Erro desconhecido');
                }
            } catch (error) {
                console.error('Erro no cadastro:', error);
                document.getElementById('errorMessage').textContent = 'Erro: ' + error.message + '.\nPor favor, verifique os dados e tente novamente.';
                document.getElementById('errorModal').style.display = 'flex';
            }
        });

        document.querySelector('.logout-button').addEventListener('click', function() {
            if ( confirm('Deseja realmente sair do sistema?')) {
                window.location.href = '/login';
            }
        });

        document.querySelector('input[name="cpf"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            this.value = value;
        });

        document.querySelector('input[name="cpf_responsavel"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            this.value = value;
        });

        document.querySelector('input[name="telefone"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            this.value = value;
        });

        document.querySelector('input[name="cep"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            this.value = value;
        });

        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('mobile-hidden');
                document.querySelector('.sidebar-overlay').classList.remove('active');
            } else {
                document.getElementById('sidebar').classList.add('mobile-hidden');
            }
        });

        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal('successModal');
            }
        });

        document.getElementById('errorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal('errorModal');
            }
        });

        const profileToggle = document.getElementById('profile-toggle');
        const profileDropdown = document.getElementById('profile-dropdown-menu');
        const profileArrow = document.querySelector('.profile-arrow');

        if (profileToggle) {
            profileToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                profileDropdown.classList.toggle('active');
                
                if (profileDropdown.classList.contains('active')) {
                    profileArrow.style.transform = 'rotate(180deg)';
                } else {
                    profileArrow.style.transform = 'rotate(0deg)';
                }
            });

            document.addEventListener('click', function() {
                if (profileDropdown && profileDropdown.classList.contains('active')) {
                    profileDropdown.classList.remove('active');
                    profileArrow.style.transform = 'rotate(0deg)';
                }
            });
        }
    </script>
</body>
</html>